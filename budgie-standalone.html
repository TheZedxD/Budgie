<!DOCTYPE html>
<html lang="en">
<head>
  <!-- CHANGELOG: Removed in-browser Babel, added CDN loader with fallbacks, precompiled Budgie app script, and a Recharts sanity-check chart -->
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Budgie Standalone</title>
  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css"
  />
  <style>
    body {
      font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    }
    .min-h-screen {
      min-height: 100vh;
    }
  </style>
</head>
<body>
  <div id="root"></div>
  <script>
(function() {
  const cdnScripts = [
    {
      name: 'React',
      global: 'React',
      urls: [
        'https://unpkg.com/react@18/umd/react.production.min.js',
        'https://cdn.jsdelivr.net/npm/react@18/umd/react.production.min.js'
      ]
    },
    {
      name: 'ReactDOM',
      global: 'ReactDOM',
      urls: [
        'https://unpkg.com/react-dom@18/umd/react-dom.production.min.js',
        'https://cdn.jsdelivr.net/npm/react-dom@18/umd/react-dom.production.min.js'
      ]
    },
    {
      name: 'PropTypes',
      global: 'PropTypes',
      urls: [
        'https://unpkg.com/prop-types/prop-types.min.js',
        'https://cdn.jsdelivr.net/npm/prop-types/prop-types.min.js'
      ]
    },
    {
      name: 'Recharts',
      global: 'Recharts',
      urls: [
        'https://unpkg.com/recharts@2/umd/Recharts.min.js',
        'https://cdn.jsdelivr.net/npm/recharts@2/umd/Recharts.min.js'
      ]
    }
  ];

  const overlayId = 'budgie-error-overlay';

  function createOverlay() {
    let overlay = document.getElementById(overlayId);
    if (overlay) {
      return overlay;
    }
    overlay = document.createElement('div');
    overlay.id = overlayId;
    overlay.style.position = 'fixed';
    overlay.style.top = '0';
    overlay.style.left = '0';
    overlay.style.right = '0';
    overlay.style.bottom = '0';
    overlay.style.background = 'rgba(17,24,39,0.94)';
    overlay.style.color = '#f9fafb';
    overlay.style.zIndex = '9999';
    overlay.style.display = 'flex';
    overlay.style.flexDirection = 'column';
    overlay.style.alignItems = 'center';
    overlay.style.justifyContent = 'center';
    overlay.style.padding = '24px';
    overlay.style.fontFamily = "'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif";
    document.body.appendChild(overlay);
    return overlay;
  }

  function showOverlay(title, message) {
    const overlay = createOverlay();
    overlay.innerHTML = '';
    const heading = document.createElement('h2');
    heading.textContent = title;
    heading.style.fontSize = '24px';
    heading.style.fontWeight = '700';
    heading.style.marginBottom = '16px';

    const paragraph = document.createElement('pre');
    paragraph.textContent = message;
    paragraph.style.whiteSpace = 'pre-wrap';
    paragraph.style.textAlign = 'center';
    paragraph.style.maxWidth = '720px';
    paragraph.style.lineHeight = '1.5';

    overlay.appendChild(heading);
    overlay.appendChild(paragraph);
  }

  function showRuntimeError(error) {
    showOverlay('Budgie crashed', error && error.stack ? error.stack : String(error));
  }

  function loadScriptsSequentially(items, index, onComplete) {
    if (index >= items.length) {
      onComplete();
      return;
    }

    const item = items[index];
    let urlIndex = 0;

    function tryLoad() {
      if (urlIndex >= item.urls.length) {
        showOverlay(
          'CDN Load Failed',
          `Unable to load ${item.name} from any CDN.\nTried:\n- ${item.urls.join('\n- ')}`
        );
        return;
      }

      const url = item.urls[urlIndex];
      const script = document.createElement('script');
      script.src = url;
      script.async = false;
      script.crossOrigin = 'anonymous';
      script.onload = function() {
        loadScriptsSequentially(items, index + 1, onComplete);
      };
      script.onerror = function() {
        urlIndex += 1;
        script.remove();
        tryLoad();
      };
      document.head.appendChild(script);
    }

    tryLoad();
  }

  function boot() {
    loadScriptsSequentially(cdnScripts, 0, startApp);
  }

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', boot);
  } else {
    boot();
  }

  function startApp() {
    if (!window.React || !window.ReactDOM) {
      showOverlay('Missing React', 'React or ReactDOM failed to load.');
      return;
    }

    const React = window.React;
    const ReactDOM = window.ReactDOM;
    const e = React.createElement;

    const useState = React.useState;
    const useMemo = React.useMemo;
    const useEffect = React.useEffect;

    const recharts = window.Recharts;
    if (!recharts) {
      showOverlay('Recharts Unavailable', 'Recharts failed to load. Please check your connection and refresh.');
      return;
    }

    const {
      ResponsiveContainer,
      PieChart: RechartsPieChart,
      Pie,
      Cell,
      Tooltip,
      Legend,
      BarChart,
      Bar,
      CartesianGrid,
      XAxis,
      YAxis,
      LineChart,
      Line
    } = recharts;

    console.info('Budgie dependencies', {
      React: React.version,
      ReactDOM: ReactDOM.version,
      Recharts: recharts.version || 'unknown'
    });

    function wrapChildren(children) {
      if (children === null || children === undefined) {
        return [];
      }
      return Array.isArray(children) ? children : [children];
    }

    function IconBase(props) {
      const { children, className, viewBox } = props;
      return e(
        'svg',
        {
          className: className || '',
          fill: 'none',
          stroke: 'currentColor',
          strokeWidth: '2',
          strokeLinecap: 'round',
          strokeLinejoin: 'round',
          viewBox: viewBox || '0 0 24 24'
        },
        ...wrapChildren(children)
      );
    }

    function createPath(d) {
      return e('path', { d });
    }

    function CalendarIcon(props) {
      return e(
        IconBase,
        props,
        e('rect', { x: '3', y: '4', width: '18', height: '18', rx: '2', ry: '2' }),
        e('line', { x1: '16', y1: '2', x2: '16', y2: '6' }),
        e('line', { x1: '8', y1: '2', x2: '8', y2: '6' }),
        e('line', { x1: '3', y1: '10', x2: '21', y2: '10' })
      );
    }

    function DollarSignIcon(props) {
      return e(
        IconBase,
        props,
        e('line', { x1: '12', y1: '1', x2: '12', y2: '23' }),
        e('path', { d: 'M17 5H9.5a3.5 3.5 0 000 7h5a3.5 3.5 0 110 7H6' })
      );
    }

    function PlusIcon(props) {
      return e(
        IconBase,
        props,
        e('line', { x1: '12', y1: '5', x2: '12', y2: '19' }),
        e('line', { x1: '5', y1: '12', x2: '19', y2: '12' })
      );
    }

    function SettingsIcon(props) {
      return e(
        IconBase,
        props,
        e('circle', { cx: '12', cy: '12', r: '3' }),
        createPath('M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 01-2.83 2.83l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.5 1.65 1.65 0 00-1 1V21a2 2 0 01-4 0v-.09a1.65 1.65 0 00-1-1.51 1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83-2.83l.06-.06a1.65 1.65 0 00.33-1.82 1.65 1.65 0 00-1.51-1H3a2 2 0 010-4h.09a1.65 1.65 0 001.51-1 1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 112.83-2.83l.06.06a1.65 1.65 0 001.82.33H9a1.65 1.65 0 001-1.51V3a2 2 0 014 0v.09a1.65 1.65 0 001 1.51h.09a1.65 1.65 0 001.82-.33l.06-.06a2 2 0 112.83 2.83l-.06.06a1.65 1.65 0 00-.33 1.82v.09a1.65 1.65 0 001.51 1H21a2 2 0 010 4h-.09a1.65 1.65 0 00-1.51 1z')
      );
    }

    function PieChartIcon(props) {
      return e(
        IconBase,
        props,
        createPath('M21.21 15.89A10 10 0 1112 2v10z'),
        createPath('M22 12A10 10 0 0012 2v10z')
      );
    }

    function CreditCardIcon(props) {
      return e(
        IconBase,
        props,
        e('rect', { x: '2', y: '5', width: '20', height: '14', rx: '2' }),
        e('line', { x1: '2', y1: '10', x2: '22', y2: '10' })
      );
    }

    function WalletIcon(props) {
      return e(
        IconBase,
        props,
        e('rect', { x: '3', y: '5', width: '18', height: '14', rx: '2', ry: '2' }),
        e('path', { d: 'M16 7h1a2 2 0 012 2v6a2 2 0 01-2 2h-1z' }),
        e('path', { d: 'M7 7a2 2 0 012-2h8' })
      );
    }

    function ChevronLeftIcon(props) {
      return e(IconBase, props, e('polyline', { points: '15 18 9 12 15 6' }));
    }

    function ChevronRightIcon(props) {
      return e(IconBase, props, e('polyline', { points: '9 18 15 12 9 6' }));
    }

    function MoonIcon(props) {
      return e(IconBase, props, createPath('M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z'));
    }

    function SunIcon(props) {
      return e(
        IconBase,
        props,
        e('circle', { cx: '12', cy: '12', r: '5' }),
        e('line', { x1: '12', y1: '1', x2: '12', y2: '3' }),
        e('line', { x1: '12', y1: '21', x2: '12', y2: '23' }),
        e('line', { x1: '4.22', y1: '4.22', x2: '5.64', y2: '5.64' }),
        e('line', { x1: '18.36', y1: '18.36', x2: '19.78', y2: '19.78' }),
        e('line', { x1: '1', y1: '12', x2: '3', y2: '12' }),
        e('line', { x1: '21', y1: '12', x2: '23', y2: '12' }),
        e('line', { x1: '4.22', y1: '19.78', x2: '5.64', y2: '18.36' }),
        e('line', { x1: '18.36', y1: '5.64', x2: '19.78', y2: '4.22' })
      );
    }

    function generateCalendar(year, month, firstWeekday) {
      const startWeekday = typeof firstWeekday === 'number' ? firstWeekday : 6;
      const firstDay = new Date(year, month, 1);
      const lastDay = new Date(year, month + 1, 0);
      const daysInMonth = lastDay.getDate();
      const startingDayOfWeek = firstDay.getDay();

      let offset = startingDayOfWeek - startWeekday;
      if (offset < 0) offset += 7;

      const weeks = [];
      let currentWeek = Array(offset).fill(null);

      for (let day = 1; day <= daysInMonth; day += 1) {
        currentWeek.push(day);
        if (currentWeek.length === 7) {
          weeks.push(currentWeek);
          currentWeek = [];
        }
      }

      if (currentWeek.length > 0) {
        while (currentWeek.length < 7) {
          currentWeek.push(null);
        }
        weeks.push(currentWeek);
      }

      return weeks;
    }

    function BudgieApp() {
      const [darkMode, setDarkMode] = useState(false);
      const [currentDate, setCurrentDate] = useState(new Date());
      const [activeView, setActiveView] = useState('calendar');
      const [selectedDate, setSelectedDate] = useState(null);
      const [showDayModal, setShowDayModal] = useState(false);
      const [sidebarOpen, setSidebarOpen] = useState(false);
      const [contextMenu, setContextMenu] = useState(null);
      const [showTransactionManager, setShowTransactionManager] = useState(false);
      const [editingTransaction, setEditingTransaction] = useState(null);
      const [showCryptoManager, setShowCryptoManager] = useState(false);
      const [editingCrypto, setEditingCrypto] = useState(null);
      const [transactions, setTransactions] = useState([]);
      const [cryptoHoldings, setCryptoHoldings] = useState([]);
      const [currentBalance, setCurrentBalance] = useState(0);

      useEffect(function syncBackground() {
        const background = darkMode ? '#111827' : '#f9fafb';
        document.body.style.backgroundColor = background;
        document.documentElement.style.backgroundColor = background;
        return function cleanup() {
          document.body.style.backgroundColor = '';
          document.documentElement.style.backgroundColor = '';
        };
      }, [darkMode]);

      const year = currentDate.getFullYear();
      const month = currentDate.getMonth();
      const monthName = currentDate.toLocaleString('default', { month: 'long' });

      function getTransactionsForDate(date) {
        const targetDate = new Date(year, month, date);
        return transactions.filter(function matchTransaction(t) {
          const start = new Date(t.startDate);
          if (Number.isNaN(start.getTime())) {
            return false;
          }

          if (targetDate < start) return false;

          if (t.frequency === 'one-time') {
            return start.toDateString() === targetDate.toDateString();
          }
          if (t.frequency === 'daily') {
            return true;
          }
          if (t.frequency === 'weekly') {
            const diff = Math.floor((targetDate - start) / (1000 * 60 * 60 * 24));
            return diff >= 0 && diff % 7 === 0;
          }
          if (t.frequency === 'bi-weekly') {
            const diff = Math.floor((targetDate - start) / (1000 * 60 * 60 * 24));
            return diff >= 0 && diff % 14 === 0;
          }
          if (t.frequency === 'monthly') {
            return start.getDate() === date;
          }
          if (t.frequency === 'yearly') {
            return start.getDate() === date && start.getMonth() === month;
          }
          return false;
        });
      }

      function getDailyTotal(date) {
        return getTransactionsForDate(date).reduce(function reducer(sum, t) {
          return sum + (t.type === 'income' ? t.amount : -t.amount);
        }, 0);
      }

      function clearTransactionsForDay(date) {
        const targetDate = new Date(year, month, date);
        setTransactions(function(prev) {
          return prev.filter(function keep(t) {
            const start = new Date(t.startDate);
            if (t.frequency === 'one-time') {
              return start.toDateString() !== targetDate.toDateString();
            }
            return true;
          });
        });
        setContextMenu(null);
      }

      const monthlyTotals = useMemo(function computeMonthlyTotals() {
        let income = 0;
        let expenses = 0;
        const lastDay = new Date(year, month + 1, 0).getDate();
        for (let day = 1; day <= lastDay; day += 1) {
          const dayTransactions = getTransactionsForDate(day);
          dayTransactions.forEach(function accumulate(t) {
            if (t.type === 'income') income += t.amount;
            else expenses += t.amount;
          });
        }
        return { income, expenses, net: income - expenses };
      }, [month, year, transactions]);

      const categoryData = useMemo(function computeCategoryData() {
        const categories = {};
        const lastDay = new Date(year, month + 1, 0).getDate();
        for (let day = 1; day <= lastDay; day += 1) {
          const dayTransactions = getTransactionsForDate(day);
          dayTransactions.forEach(function accumulate(t) {
            if (t.type === 'expense') {
              const key = t.category || 'Uncategorized';
              categories[key] = (categories[key] || 0) + t.amount;
            }
          });
        }
        return Object.entries(categories).map(function entry([name, value]) {
          return { name, value };
        });
      }, [month, year, transactions]);

      const cryptoValue = cryptoHoldings.reduce(function sumHoldings(sum, holding) {
        return sum + holding.amount * holding.currentPrice;
      }, 0);
      const totalNetWorth = currentBalance + cryptoValue;

      const cryptoPieData = cryptoHoldings.map(function mapHolding(h) {
        return { name: h.symbol, value: h.amount * h.currentPrice, fullName: h.name };
      });

      function exportBudgie() {
        const data = {
          transactions,
          cryptoHoldings,
          currentBalance,
          exportDate: new Date().toISOString(),
          version: '1.0'
        };
        const dataStr = JSON.stringify(data, null, 2);
        const blob = new Blob([dataStr], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.href = url;
        link.download = `budgie-backup-${new Date().toISOString().split('T')[0]}.json`;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        URL.revokeObjectURL(url);
      }

      function importBudgie(event) {
        const file = event.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = function onLoad(e) {
          try {
            const data = JSON.parse(e.target.result);
            if (data.transactions) setTransactions(data.transactions);
            if (data.cryptoHoldings) setCryptoHoldings(data.cryptoHoldings);
            if (typeof data.currentBalance === 'number') setCurrentBalance(data.currentBalance);
            alert('Data loaded successfully!');
          } catch (error) {
            alert('Error loading file: ' + error.message);
          }
        };
        reader.readAsText(file);
        event.target.value = '';
      }

      const calendarWeeks = useMemo(function computeCalendar() {
        return generateCalendar(year, month);
      }, [year, month]);

      const today = new Date();
      const isCurrentMonth = today.getMonth() === month && today.getFullYear() === year;
      const COLORS = ['#3b82f6', '#10b981', '#f59e0b', '#ef4444', '#8b5cf6', '#ec4899', '#06b6d4', '#84cc16'];

      function prevMonth() {
        setCurrentDate(new Date(year, month - 1));
      }

      function nextMonth() {
        setCurrentDate(new Date(year, month + 1));
      }

      function gotoToday() {
        setCurrentDate(new Date());
      }

      const bgClass = darkMode ? 'bg-gray-900' : 'bg-gray-50';
      const cardBg = darkMode ? 'bg-gray-800' : 'bg-white';
      const textClass = darkMode ? 'text-white' : 'text-gray-900';
      const textMuted = darkMode ? 'text-gray-400' : 'text-gray-600';
      const borderClass = darkMode ? 'border-gray-700' : 'border-gray-200';

      function handleRightClick(event, day) {
        event.preventDefault();
        setContextMenu({ x: event.pageX, y: event.pageY, day });
      }

      function handleBackgroundClick() {
        setSelectedDate(null);
        setContextMenu(null);
      }

      function renderDarkModeToggle() {
        return e(
          'button',
          {
            onClick: function toggleDarkMode() {
              setDarkMode(function(prev) {
                return !prev;
              });
            },
            className: `p-2 rounded-lg transition-colors ${darkMode ? 'hover:bg-gray-700' : 'hover:bg-gray-100'}`,
            title: 'Toggle dark mode'
          },
          darkMode ? e(SunIcon, { className: 'w-5 h-5' }) : e(MoonIcon, { className: 'w-5 h-5' })
        );
      }

      function renderHeader() {
        function navButton(buttonView, IconComponent) {
          const isActive = activeView === buttonView;
          const baseClass = 'px-4 py-2 rounded-lg transition-colors';
          const stateClass = isActive
            ? 'bg-blue-500 text-white'
            : darkMode
              ? 'hover:bg-gray-700'
              : 'hover:bg-gray-100';
          return e(
            'button',
            {
              key: buttonView,
              onClick: function() {
                setActiveView(buttonView);
              },
              className: `${baseClass} ${stateClass}`
            },
            e(IconComponent, { className: 'w-5 h-5' })
          );
        }

        return e(
          'header',
          {
            className: `${cardBg} border-b ${borderClass} shadow-sm fixed top-0 left-0 right-0 z-20 backdrop-blur-md bg-opacity-95`
          },
          e(
            'div',
            { className: 'max-w-7xl mx-auto px-4 py-4' },
            e(
              'div',
              { className: 'flex items-center justify-between' },
              e(
                'div',
                { className: 'flex items-center gap-3' },
                e(
                  'button',
                  {
                    onClick: function() {
                      setSidebarOpen(true);
                    },
                    className: `p-2 rounded-lg transition-colors ${darkMode ? 'hover:bg-gray-700' : 'hover:bg-gray-100'}`
                  },
                  e(
                    'svg',
                    { className: 'w-6 h-6', fill: 'none', stroke: 'currentColor', viewBox: '0 0 24 24' },
                    e('path', {
                      strokeLinecap: 'round',
                      strokeLinejoin: 'round',
                      strokeWidth: '2',
                      d: 'M4 6h16M4 12h16M4 18h16'
                    })
                  )
                ),
                e(WalletIcon, { className: 'w-8 h-8 text-blue-500' }),
                e('h1', { className: 'text-2xl font-bold' }, 'Budgie')
              ),
              e(
                'nav',
                { className: 'flex items-center gap-2' },
                [navButton('calendar', CalendarIcon), navButton('transactions', CreditCardIcon), navButton('analytics', PieChartIcon), renderDarkModeToggle()]
              )
            )
          )
        );
      }

      function renderSummary() {
        return e(
          'div',
          { className: `${cardBg} rounded-lg border ${borderClass} p-6 shadow-sm mb-6` },
          e(
            'div',
            { className: 'flex items-center justify-between gap-8' },
            e(
              'div',
              { className: 'flex-1' },
              e('p', { className: `text-sm ${textMuted} mb-1` }, 'Total Net Worth'),
              e(
                'p',
                { className: 'text-4xl font-bold text-green-500' },
                `$${totalNetWorth.toLocaleString(undefined, { maximumFractionDigits: 0 })}`
              )
            ),
            e(
              'div',
              { className: 'flex gap-8 items-center' },
              e(
                'div',
                null,
                e('p', { className: `text-xs ${textMuted} mb-1` }, 'Current Balance'),
                e('p', { className: 'text-2xl font-semibold' }, `$${currentBalance.toLocaleString()}`)
              ),
              e(
                'div',
                null,
                e('p', { className: `text-xs ${textMuted} mb-1` }, 'Crypto Portfolio'),
                e(
                  'p',
                  { className: 'text-2xl font-semibold text-blue-500' },
                  `$${cryptoValue.toLocaleString(undefined, { maximumFractionDigits: 0 })}`
                )
              )
            )
          )
        );
      }

      function renderCalendarView() {
        const weekdayHeaders = ['Sat', 'Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri'].map(function(day) {
          return e('div', { key: day, className: 'text-center text-sm font-semibold py-2' }, day);
        });

        const weeks = calendarWeeks.map(function(week, weekIdx) {
          return week.map(function(day, dayIdx) {
            if (!day) {
              return e('div', { key: `${weekIdx}-${dayIdx}`, className: 'aspect-square' });
            }

            const dailyTotal = getDailyTotal(day);
            const isToday = isCurrentMonth && day === today.getDate();
            const hasTransactions = dailyTotal !== 0;
            const isSelected = selectedDate === day;
            let cellBg = darkMode ? 'bg-gray-700' : 'bg-gray-100';
            if (isToday) {
              cellBg = 'bg-orange-500';
            } else if (isSelected) {
              cellBg = 'bg-blue-500';
            } else if (hasTransactions) {
              cellBg = dailyTotal > 0
                ? darkMode
                  ? 'bg-green-900'
                  : 'bg-green-100'
                : darkMode
                  ? 'bg-red-900'
                  : 'bg-red-100';
            }

            const totalClass = isToday || isSelected
              ? 'text-white'
              : dailyTotal > 0
                ? 'text-green-500'
                : 'text-red-500';

            return e(
              'button',
              {
                key: `${weekIdx}-${dayIdx}`,
                onClick: function(event) {
                  event.stopPropagation();
                  setSelectedDate(day);
                  setShowDayModal(true);
                },
                onContextMenu: function(event) {
                  event.stopPropagation();
                  handleRightClick(event, day);
                },
                className: `aspect-square rounded-lg p-2 transition-all hover:scale-105 ${cellBg} ${
                  isToday || isSelected ? 'text-white font-bold ring-2 ring-offset-2 ring-blue-400' : ''
                }`
              },
              e('div', { className: 'text-sm font-semibold' }, day),
              hasTransactions
                ? e(
                    'div',
                    { className: `text-xs mt-1 ${totalClass}` },
                    `${dailyTotal > 0 ? '+' : ''}${dailyTotal.toLocaleString()}`
                  )
                : null
            );
          });
        });

        return e(
          'div',
          { className: `${cardBg} rounded-lg border ${borderClass} shadow-sm` },
          e(
            'div',
            { className: `p-4 border-b ${borderClass} flex items-center justify-between` },
            e(
              'button',
              {
                onClick: prevMonth,
                className: `p-2 rounded-lg ${darkMode ? 'hover:bg-gray-700' : 'hover:bg-gray-100'} transition-colors`
              },
              e(ChevronLeftIcon, { className: 'w-5 h-5' })
            ),
            e(
              'div',
              { className: 'text-center' },
              e('h2', { className: 'text-xl font-bold' }, `${monthName} ${year}`),
              e('p', { className: `text-sm ${textMuted}` }, today.toLocaleDateString())
            ),
            e(
              'div',
              { className: 'flex gap-2' },
              e(
                'button',
                {
                  onClick: gotoToday,
                  className: `px-4 py-2 rounded-lg ${darkMode ? 'hover:bg-gray-700' : 'hover:bg-gray-100'} transition-colors text-sm`
                },
                'Today'
              ),
              e(
                'button',
                {
                  onClick: nextMonth,
                  className: `p-2 rounded-lg ${darkMode ? 'hover:bg-gray-700' : 'hover:bg-gray-100'} transition-colors`
                },
                e(ChevronRightIcon, { className: 'w-5 h-5' })
              )
            )
          ),
          e(
            'div',
            { className: 'p-4' },
            e('div', { className: 'grid grid-cols-7 gap-2 mb-2' }, weekdayHeaders),
            e(
              'div',
              { className: 'grid grid-cols-7 gap-2' },
              weeks.map(function(row, rowIndex) {
                return e(React.Fragment, { key: `week-${rowIndex}` }, row);
              })
            )
          )
        );
      }

      function renderTransactionsView() {
        return e(
          'div',
          { className: `${cardBg} rounded-lg border ${borderClass} shadow-sm` },
          e(
            'div',
            { className: `p-4 border-b ${borderClass} flex items-center justify-between` },
            e('h2', { className: 'text-xl font-bold' }, 'Transactions Overview'),
            e(
              'button',
              {
                onClick: function() {
                  setEditingTransaction({});
                },
                className: 'px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors text-sm flex items-center gap-2'
              },
              e(PlusIcon, { className: 'w-4 h-4' }),
              'Add Transaction'
            )
          ),
          e(
            'div',
            { className: 'p-4 space-y-3' },
            transactions.length
              ? transactions.map(function(t) {
                  return e(
                    'div',
                    {
                      key: t.id,
                      className: `p-4 rounded-lg ${darkMode ? 'bg-gray-700' : 'bg-gray-100'} hover:bg-opacity-80 transition-colors`
                    },
                    e(
                      'div',
                      { className: 'flex justify-between items-start' },
                      e(
                        'div',
                        { className: 'flex-1' },
                        e('p', { className: 'font-semibold text-lg' }, t.name),
                        e(
                          'div',
                          { className: 'flex gap-4 mt-2 text-sm' },
                          e('span', { className: textMuted }, `${t.frequency}`),
                          e('span', { className: textMuted }, `${t.category}`)
                        )
                      ),
                      e(
                        'div',
                        { className: 'text-right' },
                        e(
                          'p',
                          {
                            className: `text-xl font-bold ${
                              t.type === 'income' ? 'text-green-500' : 'text-red-500'
                            }`
                          },
                          `${t.type === 'income' ? '+' : '-'}$${t.amount}`
                        )
                      )
                    )
                  );
                })
              : e('div', { className: 'text-center py-12' }, e('p', { className: `text-lg ${textMuted}` }, 'No transactions yet'))
          )
        );
      }

      function renderAnalyticsView() {
        return e(
          'div',
          { className: `${cardBg} rounded-lg border ${borderClass} shadow-sm p-6 space-y-6` },
          e('h2', { className: 'text-xl font-bold' }, 'Analytics'),
          e(
            'div',
            { className: 'grid grid-cols-1 lg:grid-cols-2 gap-6' },
            [
              e(
                'div',
                { key: 'category', className: `${darkMode ? 'bg-gray-900/40' : 'bg-gray-50'} rounded-lg p-4` },
                e('h3', { className: 'text-lg font-semibold mb-2' }, 'Expense Categories'),
                categoryData.length
                  ? e(
                      ResponsiveContainer,
                      { width: '100%', height: 260 },
                      e(
                        RechartsPieChart,
                        null,
                        e(Tooltip, null),
                        e(Legend, null),
                        e(
                          Pie,
                          {
                            data: categoryData,
                            dataKey: 'value',
                            nameKey: 'name',
                            cx: '50%',
                            cy: '50%',
                            outerRadius: 80,
                            fill: '#8884d8'
                          },
                          categoryData.map(function(entry, index) {
                            return e(Cell, {
                              key: `cell-${entry.name}`,
                              fill: COLORS[index % COLORS.length]
                            });
                          })
                        )
                      )
                    )
                  : e('p', { className: textMuted }, 'No expense data yet')
              ),
              e(
                'div',
                { key: 'cashflow', className: `${darkMode ? 'bg-gray-900/40' : 'bg-gray-50'} rounded-lg p-4` },
                e('h3', { className: 'text-lg font-semibold mb-2' }, 'Cash Flow by Day'),
                e(
                  ResponsiveContainer,
                  { width: '100%', height: 260 },
                  e(
                    BarChart,
                    {
                      data: calendarWeeks
                        .flat()
                        .filter(function(day) {
                          return Boolean(day);
                        })
                        .map(function(day) {
                          return { day, total: getDailyTotal(day) };
                        })
                    },
                    e(CartesianGrid, { strokeDasharray: '3 3' }),
                    e(XAxis, { dataKey: 'day' }),
                    e(YAxis, null),
                    e(Tooltip, null),
                    e(Legend, null),
                    e(Bar, { dataKey: 'total', fill: '#3b82f6' })
                  )
                )
              )
            ]
          ),
          e(
            'div',
            { className: `${darkMode ? 'bg-gray-900/40' : 'bg-gray-50'} rounded-lg p-4` },
            e('h3', { className: 'text-lg font-semibold mb-2' }, 'Chart Sanity Check'),
            e(
              ResponsiveContainer,
              { width: '100%', height: 160 },
              e(
                LineChart,
                { data: [{ name: 'A', value: 2 }, { name: 'B', value: 3 }, { name: 'C', value: 5 }] },
                e(CartesianGrid, { strokeDasharray: '4 4' }),
                e(XAxis, { dataKey: 'name' }),
                e(YAxis, null),
                e(Tooltip, null),
                e(Line, { type: 'monotone', dataKey: 'value', stroke: '#10b981', strokeWidth: 2 })
              )
            )
          )
        );
      }

      function renderMainContent() {
        let content = null;
        if (activeView === 'calendar') {
          content = renderCalendarView();
        } else if (activeView === 'transactions') {
          content = renderTransactionsView();
        } else {
          content = renderAnalyticsView();
        }
        return e('main', null, content);
      }

      function renderCryptoSection() {
        return e(
          'div',
          { className: `${cardBg} rounded-lg border ${borderClass} shadow-sm mt-6` },
          e(
            'div',
            { className: `p-4 border-b ${borderClass} flex items-center justify-between` },
            e('h2', { className: 'text-xl font-bold' }, 'Crypto Portfolio'),
            e(
              'button',
              {
                onClick: function() {
                  setEditingCrypto({});
                },
                className: 'px-4 py-2 bg-purple-500 text-white rounded-lg hover:bg-purple-600 transition-colors text-sm flex items-center gap-2'
              },
              e(PlusIcon, { className: 'w-4 h-4' }),
              'Add Crypto'
            )
          ),
          cryptoHoldings.length
            ? e(
                'div',
                { className: 'p-4 grid grid-cols-1 md:grid-cols-2 gap-4' },
                cryptoHoldings.map(function(h, index) {
                  const currentValue = h.amount * h.currentPrice;
                  const investment = h.amount * h.purchasePrice;
                  const profit = currentValue - investment;
                  const profitPercent = investment > 0 ? ((profit / investment) * 100).toFixed(2) : '0.00';
                  const totalHoldingsValue = cryptoHoldings.reduce(function(sum, holding) {
                    return sum + holding.amount * holding.currentPrice;
                  }, 0);
                  const portfolioPercent = totalHoldingsValue > 0 ? ((currentValue / totalHoldingsValue) * 100).toFixed(2) : '0.00';

                  return e(
                    'div',
                    {
                      key: h.id || `crypto-${index}`,
                      className: `${darkMode ? 'bg-gray-700' : 'bg-gray-100'} rounded-lg p-4 flex flex-col gap-3`
                    },
                    e(
                      'div',
                      { className: 'flex items-center justify-between' },
                      e(
                        'div',
                        { className: 'flex items-center gap-3' },
                        e(
                          'div',
                          {
                            className: 'w-12 h-12 rounded-full flex items-center justify-center text-lg font-bold text-white',
                            style: { background: COLORS[index % COLORS.length] }
                          },
                          h.symbol
                        ),
                        e(
                          'div',
                          null,
                          e('p', { className: 'font-bold' }, h.symbol),
                          e('p', { className: `text-xs ${textMuted}` }, h.name)
                        )
                      ),
                      e(
                        'div',
                        { className: 'text-right' },
                        e(
                          'p',
                          { className: 'font-semibold' },
                          `$${currentValue.toLocaleString(undefined, { maximumFractionDigits: 0 })}`
                        ),
                        e('p', { className: `text-xs ${textMuted}` }, `${portfolioPercent}%`)
                      )
                    ),
                    e(
                      'div',
                      { className: 'mt-1 flex justify-between text-xs' },
                      e('span', { className: textMuted }, `${h.amount} @ $${h.currentPrice.toLocaleString()}`),
                      e(
                        'span',
                        { className: profit >= 0 ? 'text-green-500' : 'text-red-500' },
                        `${profit >= 0 ? '+' : ''}${profitPercent}%`
                      )
                    ),
                    e(
                      'div',
                      { className: 'flex gap-2' },
                      e(
                        'button',
                        {
                          onClick: function() {
                            setEditingCrypto(h);
                          },
                          className: 'px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors text-xs'
                        },
                        'Edit'
                      ),
                      e(
                        'button',
                        {
                          onClick: function() {
                            if (window.confirm(`Delete ${h.name}?`)) {
                              setCryptoHoldings(function(prev) {
                                return prev.filter(function(item) {
                                  return item.id !== h.id;
                                });
                              });
                            }
                          },
                          className: 'px-3 py-1 bg-red-500 text-white rounded hover:bg-red-600 transition-colors text-xs'
                        },
                        'Delete'
                      )
                    )
                  );
                })
              )
            : e('div', { className: 'text-center py-12' }, e('p', { className: textMuted }, 'No cryptocurrency holdings'))
        );
      }

      function renderContextMenu() {
        if (!contextMenu) return null;
        return e(
          'div',
          {
            className: `fixed ${cardBg} border ${borderClass} rounded-lg shadow-xl py-2 z-50`,
            style: { left: `${contextMenu.x}px`, top: `${contextMenu.y}px` },
            onClick: function(event) {
              event.stopPropagation();
            }
          },
          e(
            'button',
            {
              onClick: function() {
                clearTransactionsForDay(contextMenu.day);
              },
              className: 'w-full px-4 py-2 text-left hover:bg-red-500 hover:text-white transition-colors flex items-center gap-2'
            },
            e(
              'svg',
              { className: 'w-4 h-4', fill: 'none', stroke: 'currentColor', viewBox: '0 0 24 24' },
              e('path', {
                strokeLinecap: 'round',
                strokeLinejoin: 'round',
                strokeWidth: '2',
                d: 'M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16'
              })
            ),
            `Clear Transactions for Day ${contextMenu.day}`
          )
        );
      }

      function renderSidebarBackdrop() {
        return e(
          'div',
          {
            className: `fixed inset-0 z-40 transition-opacity duration-300 ${
              sidebarOpen ? 'opacity-100 pointer-events-auto' : 'opacity-0 pointer-events-none'
            }`,
            onClick: function() {
              setSidebarOpen(false);
            }
          },
          e('div', { className: 'absolute inset-0 bg-black bg-opacity-50' })
        );
      }

      function renderSidebarSummary() {
        return e(
          'div',
          { className: `${darkMode ? 'bg-gray-700' : 'bg-gray-100'} rounded-lg p-4` },
          e(
            'h3',
            { className: 'text-sm font-semibold mb-3 flex items-center gap-2' },
            e(CalendarIcon, { className: 'w-4 h-4' }),
            'Monthly Summary'
          ),
          e(
            'div',
            { className: 'space-y-2' },
            e(
              'div',
              { className: 'flex justify-between items-center' },
              e('span', { className: `text-sm ${textMuted}` }, 'Income'),
              e('span', { className: 'text-sm font-semibold text-green-500' }, `$${monthlyTotals.income.toLocaleString()}`)
            ),
            e(
              'div',
              { className: 'flex justify-between items-center' },
              e('span', { className: `text-sm ${textMuted}` }, 'Expenses'),
              e('span', { className: 'text-sm font-semibold text-red-500' }, `$${monthlyTotals.expenses.toLocaleString()}`)
            ),
            e(
              'div',
              { className: 'pt-2 border-t border-gray-600' },
              e(
                'div',
                { className: 'flex justify-between items-center' },
                e('span', { className: 'text-sm font-semibold' }, 'Net'),
                e(
                  'span',
                  { className: `text-sm font-bold ${monthlyTotals.net >= 0 ? 'text-green-500' : 'text-red-500'}` },
                  `$${monthlyTotals.net >= 0 ? '+' : ''}${monthlyTotals.net.toLocaleString()}`
                )
              )
            )
          )
        );
      }

      function renderSidebarActions() {
        return e(
          'div',
          { className: `${darkMode ? 'bg-gray-700' : 'bg-gray-100'} rounded-lg p-4` },
          e(
            'h3',
            { className: 'text-sm font-semibold mb-3 flex items-center gap-2' },
            e(PlusIcon, { className: 'w-4 h-4' }),
            'Quick Actions'
          ),
          e(
            'div',
            { className: 'space-y-2' },
            e(
              'button',
              {
                onClick: function() {
                  setEditingTransaction({});
                  setSidebarOpen(false);
                },
                className: 'w-full px-4 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors flex items-center justify-center gap-2 font-medium'
              },
              e(PlusIcon, { className: 'w-5 h-5' }),
              'Add Transaction'
            ),
            e(
              'button',
              {
                onClick: function() {
                  setEditingTransaction({ type: 'income', frequency: 'bi-weekly', category: 'income' });
                  setSidebarOpen(false);
                },
                className: 'w-full px-4 py-3 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors flex items-center justify-center gap-2 font-medium'
              },
              e(PlusIcon, { className: 'w-5 h-5' }),
              'Add Paycheck'
            ),
            e(
              'button',
              {
                onClick: function() {
                  setEditingCrypto({});
                  setSidebarOpen(false);
                },
                className: 'w-full px-4 py-3 bg-purple-500 text-white rounded-lg hover:bg-purple-600 transition-colors flex items-center justify-center gap-2 font-medium'
              },
              e(PlusIcon, { className: 'w-5 h-5' }),
              'Add Crypto'
            )
          )
        );
      }

      function renderSidebarNavigation() {
        function navButton(label, view, IconComponent, extraProps) {
          const isActive = activeView === view;
          const base = 'w-full px-4 py-2 rounded-lg transition-colors text-left flex items-center gap-3';
          const state = isActive
            ? 'bg-blue-500 text-white'
            : darkMode
              ? 'hover:bg-gray-600'
              : 'hover:bg-gray-200';
          return e(
            'button',
            Object.assign(
              {
                key: view,
                onClick: function() {
                  if (view === 'manage-transactions') {
                    setShowTransactionManager(true);
                  } else if (view === 'manage-crypto') {
                    setShowCryptoManager(true);
                  } else {
                    setActiveView(view);
                  }
                  setSidebarOpen(false);
                },
                className: `${base} ${state}`
              },
              extraProps || {}
            ),
            e(IconComponent, { className: 'w-5 h-5' }),
            label
          );
        }

        return e(
          'div',
          { className: `${darkMode ? 'bg-gray-700' : 'bg-gray-100'} rounded-lg p-4` },
          e('h3', { className: 'text-sm font-semibold mb-3' }, 'Navigation'),
          e(
            'div',
            { className: 'space-y-1' },
            [
              navButton('Calendar', 'calendar', CalendarIcon),
              navButton('Transactions', 'transactions', CreditCardIcon),
              navButton('Manage All Transactions', 'manage-transactions', SettingsIcon, {
                className: `w-full px-4 py-2 rounded-lg transition-colors text-left flex items-center gap-3 ${
                  darkMode ? 'hover:bg-gray-600' : 'hover:bg-gray-200'
                }`
              }),
              navButton('Manage Crypto Holdings', 'manage-crypto', DollarSignIcon, {
                className: `w-full px-4 py-2 rounded-lg transition-colors text-left flex items-center gap-3 ${
                  darkMode ? 'hover:bg-gray-600' : 'hover:bg-gray-200'
                }`
              }),
              navButton('Analytics', 'analytics', PieChartIcon)
            ]
          )
        );
      }

      function renderSidebarSettings() {
        return e(
          'div',
          { className: `${darkMode ? 'bg-gray-700' : 'bg-gray-100'} rounded-lg p-4` },
          e(
            'h3',
            { className: 'text-sm font-semibold mb-3 flex items-center gap-2' },
            e(SettingsIcon, { className: 'w-4 h-4' }),
            'Settings'
          ),
          e(
            'div',
            { className: 'space-y-2' },
            e(
              'button',
              {
                onClick: function() {
                  const newBalance = window.prompt('Enter current balance:', currentBalance);
                  if (newBalance !== null) {
                    setCurrentBalance(parseFloat(newBalance) || 0);
                  }
                },
                className: `w-full px-4 py-2 rounded-lg transition-colors ${darkMode ? 'hover:bg-gray-600' : 'hover:bg-gray-200'}`
              },
              'Set Current Balance'
            ),
            e(
              'button',
              {
                onClick: function() {
                  setSidebarOpen(false);
                  exportBudgie();
                },
                className: `w-full px-4 py-2 rounded-lg transition-colors ${darkMode ? 'hover:bg-gray-600' : 'hover:bg-gray-200'}`
              },
              'Export Data'
            ),
            e(
              'label',
              {
                className: `w-full px-4 py-2 rounded-lg transition-colors cursor-pointer inline-flex items-center gap-2 ${
                  darkMode ? 'hover:bg-gray-600' : 'hover:bg-gray-200'
                }`
              },
              e('input', {
                type: 'file',
                accept: '.json',
                onChange: importBudgie,
                className: 'hidden'
              }),
              e('span', null, 'Import Data')
            ),
            e(
              'button',
              {
                onClick: function() {
                  setDarkMode(function(prev) {
                    return !prev;
                  });
                },
                className: `w-full px-4 py-2 rounded-lg transition-colors ${darkMode ? 'hover:bg-gray-600' : 'hover:bg-gray-200'}`
              },
              darkMode ? 'Switch to Light Mode' : 'Switch to Dark Mode'
            )
          )
        );
      }

      function renderSidebar() {
        return e(
          'aside',
          {
            className: `fixed top-0 left-0 h-full w-80 ${cardBg} shadow-2xl z-50 transform transition-transform duration-300 ease-in-out overflow-y-auto ${
              sidebarOpen ? 'translate-x-0' : '-translate-x-full'
            }`
          },
          e(
            'div',
            { className: `p-4 border-b ${borderClass} flex items-center justify-between sticky top-0 ${cardBg} z-10` },
            e('h2', { className: 'text-xl font-bold' }, 'Menu'),
            e(
              'button',
              {
                onClick: function() {
                  setSidebarOpen(false);
                },
                className: `p-2 rounded-lg transition-colors ${darkMode ? 'hover:bg-gray-700' : 'hover:bg-gray-100'}`
              },
              e(
                'svg',
                { className: 'w-6 h-6', fill: 'none', stroke: 'currentColor', viewBox: '0 0 24 24' },
                e('path', {
                  strokeLinecap: 'round',
                  strokeLinejoin: 'round',
                  strokeWidth: '2',
                  d: 'M6 18L18 6M6 6l12 12'
                })
              )
            )
          ),
          e(
            'div',
            { className: 'p-4 space-y-4' },
            [renderSidebarSummary(), renderSidebarActions(), renderSidebarNavigation(), renderSidebarSettings()]
          )
        );
      }

      function renderCryptoManagerModal() {
        if (!showCryptoManager && !editingCrypto) {
          return null;
        }

        return e(
          React.Fragment,
          null,
          showCryptoManager
            ? e(
                'div',
                {
                  className: 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4',
                  onClick: function() {
                    setShowCryptoManager(false);
                  }
                },
                e(
                  'div',
                  {
                    className: `${cardBg} rounded-lg shadow-xl w-full max-w-3xl max-h-[90vh] overflow-hidden`,
                    onClick: function(event) {
                      event.stopPropagation();
                    }
                  },
                  e(
                    'div',
                    { className: `p-6 border-b ${borderClass} flex items-center justify-between` },
                    e('h2', { className: 'text-2xl font-bold' }, 'Manage Crypto Holdings'),
                    e(
                      'button',
                      {
                        onClick: function() {
                          setShowCryptoManager(false);
                        },
                        className: `p-2 rounded-lg transition-colors ${darkMode ? 'hover:bg-gray-700' : 'hover:bg-gray-100'}`
                      },
                      e(
                        'svg',
                        { className: 'w-6 h-6', fill: 'none', stroke: 'currentColor', viewBox: '0 0 24 24' },
                        e('path', {
                          strokeLinecap: 'round',
                          strokeLinejoin: 'round',
                          strokeWidth: '2',
                          d: 'M6 18L18 6M6 6l12 12'
                        })
                      )
                    )
                  ),
                  e(
                    'div',
                    { className: 'p-6 overflow-y-auto max-h-[calc(90vh-160px)] space-y-3' },
                    cryptoHoldings.length
                      ? cryptoHoldings.map(function(h) {
                          return e(
                            'div',
                            {
                              key: h.id,
                              className: `${darkMode ? 'bg-gray-700' : 'bg-gray-100'} rounded-lg p-4 flex justify-between items-start`
                            },
                            e(
                              'div',
                              null,
                              e('p', { className: 'font-semibold text-lg' }, `${h.symbol}  ${h.name}`),
                              e(
                                'div',
                                { className: `text-sm ${textMuted} mt-1 space-y-1` },
                                e('div', null, `Amount: ${h.amount}`),
                                e('div', null, `Purchase Price: $${h.purchasePrice}`),
                                e('div', null, `Current Price: $${h.currentPrice}`)
                              )
                            ),
                            e(
                              'div',
                              { className: 'flex gap-2' },
                              e(
                                'button',
                                {
                                  onClick: function() {
                                    setEditingCrypto(h);
                                  },
                                  className: 'px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors text-xs'
                                },
                                'Edit'
                              ),
                              e(
                                'button',
                                {
                                  onClick: function() {
                                    if (window.confirm(`Delete ${h.name}?`)) {
                                      setCryptoHoldings(function(prev) {
                                        return prev.filter(function(item) {
                                          return item.id !== h.id;
                                        });
                                      });
                                    }
                                  },
                                  className: 'px-3 py-1 bg-red-500 text-white rounded hover:bg-red-600 transition-colors text-xs'
                                },
                                'Delete'
                              )
                            )
                          );
                        })
                      : e(
                          'div',
                          { className: 'text-center py-12' },
                          e(PieChartIcon, { className: `w-16 h-16 mx-auto mb-4 ${textMuted}` }),
                          e('p', { className: `text-lg ${textMuted}` }, 'No holdings yet')
                        )
                  ),
                  e(
                    'div',
                    { className: `p-4 border-t ${borderClass} flex justify-end gap-2` },
                    e(
                      'button',
                      {
                        onClick: function() {
                          setEditingCrypto({});
                        },
                        className: 'px-4 py-2 bg-purple-500 text-white rounded-lg hover:bg-purple-600 transition-colors'
                      },
                      'Add Holding'
                    ),
                    e(
                      'button',
                      {
                        onClick: function() {
                          setShowCryptoManager(false);
                        },
                        className: `px-4 py-2 rounded-lg transition-colors ${darkMode ? 'bg-gray-700 hover:bg-gray-600' : 'bg-gray-200 hover:bg-gray-300'}`
                      },
                      'Close'
                    )
                  )
                )
              )
            : null,
          editingCrypto ? renderCryptoEditorModal() : null
        );
      }


      function renderCryptoEditorModal() {
        if (!editingCrypto) return null;
        return e(
          'div',
          {
            className: 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4',
            onClick: function() {
              setEditingCrypto(null);
            }
          },
          e(
            'div',
            {
              className: `${cardBg} rounded-lg shadow-xl w-full max-w-3xl max-h-[90vh] overflow-hidden`,
              onClick: function(event) {
                event.stopPropagation();
              }
            },
            e(
              'div',
              { className: `p-6 border-b ${borderClass}` },
              e('h2', { className: 'text-2xl font-bold' }, editingCrypto.id ? 'Edit Crypto Holding' : 'Add Crypto Holding')
            ),
            e(
              'div',
              { className: 'p-6 overflow-y-auto max-h-[calc(90vh-200px)] space-y-4' },
              e(
                'div',
                { className: 'grid grid-cols-2 gap-4' },
                e(
                  'div',
                  null,
                  e('label', { className: 'block text-sm font-semibold mb-2' }, 'Symbol'),
                  e('input', {
                    type: 'text',
                    defaultValue: editingCrypto.symbol || '',
                    placeholder: 'BTC, ETH, etc.',
                    className: `w-full px-4 py-2 rounded-lg border ${borderClass} ${darkMode ? 'bg-gray-700' : 'bg-white'}`,
                    id: 'crypto-symbol'
                  })
                ),
                e(
                  'div',
                  null,
                  e('label', { className: 'block text-sm font-semibold mb-2' }, 'Name'),
                  e('input', {
                    type: 'text',
                    defaultValue: editingCrypto.name || '',
                    placeholder: 'Bitcoin, Ethereum, etc.',
                    className: `w-full px-4 py-2 rounded-lg border ${borderClass} ${darkMode ? 'bg-gray-700' : 'bg-white'}`,
                    id: 'crypto-name'
                  })
                )
              ),
              e(
                'div',
                null,
                e('label', { className: 'block text-sm font-semibold mb-2' }, 'Amount Held'),
                e('input', {
                  type: 'number',
                  defaultValue: editingCrypto.amount || '',
                  placeholder: '0.00',
                  step: '0.00000001',
                  className: `w-full px-4 py-2 rounded-lg border ${borderClass} ${darkMode ? 'bg-gray-700' : 'bg-white'}`,
                  id: 'crypto-amount'
                })
              ),
              e(
                'div',
                { className: 'grid grid-cols-2 gap-4' },
                e(
                  'div',
                  null,
                  e('label', { className: 'block text-sm font-semibold mb-2' }, 'Purchase Price ($)'),
                  e('input', {
                    type: 'number',
                    defaultValue: editingCrypto.purchasePrice || '',
                    placeholder: '0.00',
                    step: '0.01',
                    className: `w-full px-4 py-2 rounded-lg border ${borderClass} ${darkMode ? 'bg-gray-700' : 'bg-white'}`,
                    id: 'crypto-purchase'
                  })
                ),
                e(
                  'div',
                  null,
                  e('label', { className: 'block text-sm font-semibold mb-2' }, 'Current Price ($)'),
                  e('input', {
                    type: 'number',
                    defaultValue: editingCrypto.currentPrice || '',
                    placeholder: '0.00',
                    step: '0.01',
                    className: `w-full px-4 py-2 rounded-lg border ${borderClass} ${darkMode ? 'bg-gray-700' : 'bg-white'}`,
                    id: 'crypto-current'
                  })
                )
              )
            ),
            e(
              'div',
              { className: `p-4 border-t ${borderClass} flex justify-end gap-2` },
              e(
                'button',
                {
                  onClick: function() {
                    setEditingCrypto(null);
                  },
                  className: `px-4 py-2 rounded-lg transition-colors ${darkMode ? 'bg-gray-700 hover:bg-gray-600' : 'bg-gray-200 hover:bg-gray-300'}`
                },
                'Cancel'
              ),
              e(
                'button',
                {
                  onClick: function() {
                    const symbol = document.getElementById('crypto-symbol').value.toUpperCase();
                    const name = document.getElementById('crypto-name').value;
                    const amount = parseFloat(document.getElementById('crypto-amount').value);
                    const purchasePrice = parseFloat(document.getElementById('crypto-purchase').value);
                    const currentPrice = parseFloat(document.getElementById('crypto-current').value);

                    if (!symbol || !name || !amount || !purchasePrice || !currentPrice) {
                      window.alert('Please fill in all fields');
                      return;
                    }

                    if (editingCrypto.id) {
                      setCryptoHoldings(function(prev) {
                        return prev.map(function(h) {
                          return h.id === editingCrypto.id
                            ? Object.assign({}, h, { symbol, name, amount, purchasePrice, currentPrice })
                            : h;
                        });
                      });
                    } else {
                      const newHolding = {
                        id: Date.now(),
                        symbol,
                        name,
                        amount,
                        purchasePrice,
                        currentPrice
                      };
                      setCryptoHoldings(function(prev) {
                        return prev.concat([newHolding]);
                      });
                    }
                    setEditingCrypto(null);
                  },
                  className: 'px-4 py-2 bg-purple-500 text-white rounded-lg hover:bg-purple-600 transition-colors'
                },
                editingCrypto.id ? 'Save Changes' : 'Add Holding'
              )
            )
          )
        );
      }

      function renderTransactionManagerModal() {
        if (!showTransactionManager) return null;
        return e(
          'div',
          {
            className: 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4',
            onClick: function() {
              setShowTransactionManager(false);
            }
          },
          e(
            'div',
            {
              className: `${cardBg} rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] overflow-hidden`,
              onClick: function(event) {
                event.stopPropagation();
              }
            },
            e(
              'div',
              { className: `p-6 border-b ${borderClass} flex items-center justify-between` },
              e('h2', { className: 'text-2xl font-bold' }, 'Manage All Transactions'),
              e(
                'button',
                {
                  onClick: function() {
                    setShowTransactionManager(false);
                  },
                  className: `p-2 rounded-lg hover:bg-opacity-80 transition-colors ${darkMode ? 'hover:bg-gray-700' : 'hover:bg-gray-100'}`
                },
                e(
                  'svg',
                  { className: 'w-6 h-6', fill: 'none', stroke: 'currentColor', viewBox: '0 0 24 24' },
                  e('path', {
                    strokeLinecap: 'round',
                    strokeLinejoin: 'round',
                    strokeWidth: '2',
                    d: 'M6 18L18 6M6 6l12 12'
                  })
                )
              )
            ),
            e(
              'div',
              { className: 'p-6 overflow-y-auto max-h-[calc(90vh-140px)]' },
              transactions.length
                ? e(
                    'div',
                    { className: 'space-y-3' },
                    transactions.map(function(t) {
                      return e(
                        'div',
                        {
                          key: t.id,
                          className: `p-4 rounded-lg ${darkMode ? 'bg-gray-700' : 'bg-gray-100'} hover:bg-opacity-80 transition-colors`
                        },
                        e(
                          'div',
                          { className: 'flex justify-between items-start' },
                          e(
                            'div',
                            { className: 'flex-1' },
                            e('p', { className: 'font-semibold text-lg' }, t.name),
                            e(
                              'div',
                              { className: 'flex gap-4 mt-2 text-sm' },
                              e('span', { className: textMuted }, `Type: ${t.type === 'income' ? 'Income' : 'Expense'}`),
                              e('span', { className: textMuted }, `Frequency: ${t.frequency}`),
                              e('span', { className: textMuted }, `Category: ${t.category}`)
                            ),
                            e(
                              'div',
                              { className: 'flex gap-4 mt-1 text-sm' },
                              e('span', { className: textMuted }, `Start: ${t.startDate}`)
                            )
                          ),
                          e(
                            'div',
                            { className: 'flex flex-col gap-2 ml-4' },
                            e(
                              'div',
                              { className: 'text-right' },
                              e(
                                'p',
                                { className: `text-2xl font-bold ${t.type === 'income' ? 'text-green-500' : 'text-red-500'}` },
                                `${t.type === 'income' ? '+' : '-'}$${t.amount}`
                              )
                            ),
                            e(
                              'div',
                              { className: 'flex gap-2' },
                              e(
                                'button',
                                {
                                  onClick: function() {
                                    setEditingTransaction(t);
                                  },
                                  className: 'px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors text-sm'
                                },
                                'Edit'
                              ),
                              e(
                                'button',
                                {
                                  onClick: function() {
                                    if (window.confirm(`Delete "${t.name}"?`)) {
                                      setTransactions(function(prev) {
                                        return prev.filter(function(item) {
                                          return item.id !== t.id;
                                        });
                                      });
                                    }
                                  },
                                  className: 'px-3 py-1 bg-red-500 text-white rounded hover:bg-red-600 transition-colors text-sm'
                                },
                                'Delete'
                              )
                            )
                          )
                        )
                      );
                    })
                  )
                : e('div', { className: 'text-center py-12' }, e('p', { className: `text-lg ${textMuted}` }, 'No transactions yet'))
            ),
            e(
              'div',
              { className: `p-4 border-t ${borderClass} flex justify-between gap-2` },
              e(
                'button',
                {
                  onClick: function() {
                    setEditingTransaction({});
                  },
                  className: 'px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors'
                },
                'Add New Transaction'
              ),
              e(
                'button',
                {
                  onClick: function() {
                    setShowTransactionManager(false);
                  },
                  className: `px-4 py-2 rounded-lg transition-colors ${darkMode ? 'bg-gray-700 hover:bg-gray-600' : 'bg-gray-200 hover:bg-gray-300'}`
                },
                'Close'
              )
            )
          )
        );
      }

      function renderTransactionEditorModal() {
        if (!editingTransaction) return null;
        return e(
          'div',
          {
            className: 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4',
            onClick: function() {
              setEditingTransaction(null);
            }
          },
          e(
            'div',
            {
              className: `${cardBg} rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] overflow-hidden`,
              onClick: function(event) {
                event.stopPropagation();
              }
            },
            e(
              'div',
              { className: `p-6 border-b ${borderClass}` },
              e('h2', { className: 'text-2xl font-bold' }, editingTransaction.id ? 'Edit Transaction' : 'Add New Transaction'),
              editingTransaction.id && editingTransaction.frequency !== 'one-time'
                ? e(
                    'p',
                    { className: `text-sm ${textMuted} mt-2` },
                    'Editing this recurring transaction will affect all occurrences'
                  )
                : null
            ),
            e(
              'div',
              { className: 'p-6 overflow-y-auto max-h-[calc(90vh-200px)] space-y-4' },
              e(
                'div',
                null,
                e('label', { className: 'block text-sm font-semibold mb-2' }, 'Transaction Name'),
                e('input', {
                  type: 'text',
                  defaultValue: editingTransaction.name || '',
                  placeholder: 'Salary, Rent, etc.',
                  className: `w-full px-4 py-2 rounded-lg border ${borderClass} ${darkMode ? 'bg-gray-700' : 'bg-white'}`,
                  id: 'transaction-name'
                })
              ),
              e(
                'div',
                { className: 'grid grid-cols-2 gap-4' },
                e(
                  'div',
                  null,
                  e('label', { className: 'block text-sm font-semibold mb-2' }, 'Amount ($)'),
                  e('input', {
                    type: 'number',
                    defaultValue: editingTransaction.amount || '',
                    placeholder: '0.00',
                    step: '0.01',
                    className: `w-full px-4 py-2 rounded-lg border ${borderClass} ${darkMode ? 'bg-gray-700' : 'bg-white'}`,
                    id: 'transaction-amount'
                  })
                ),
                e(
                  'div',
                  null,
                  e('label', { className: 'block text-sm font-semibold mb-2' }, 'Transaction Type'),
                  e(
                    'select',
                    {
                      defaultValue: editingTransaction.type || 'expense',
                      className: `w-full px-4 py-2 rounded-lg border ${borderClass} ${darkMode ? 'bg-gray-700' : 'bg-white'}`,
                      id: 'transaction-type'
                    },
                    e('option', { value: 'income' }, 'Income'),
                    e('option', { value: 'expense' }, 'Expense')
                  )
                )
              ),
              e(
                'div',
                null,
                e('label', { className: 'block text-sm font-semibold mb-2' }, 'Frequency'),
                e(
                  'select',
                  {
                    defaultValue: editingTransaction.frequency || 'monthly',
                    className: `w-full px-4 py-2 rounded-lg border ${borderClass} ${darkMode ? 'bg-gray-700' : 'bg-white'}`,
                    id: 'transaction-frequency'
                  },
                  ['one-time', 'daily', 'weekly', 'bi-weekly', 'monthly', 'yearly'].map(function(freq) {
                    return e('option', { key: freq, value: freq }, freq);
                  })
                )
              ),
              e(
                'div',
                null,
                e('label', { className: 'block text-sm font-semibold mb-2' }, 'Category'),
                e(
                  'input',
                  {
                    type: 'text',
                    defaultValue: editingTransaction.category || '',
                    placeholder: 'Housing, Utilities, etc.',
                    className: `w-full px-4 py-2 rounded-lg border ${borderClass} ${darkMode ? 'bg-gray-700' : 'bg-white'}`,
                    id: 'transaction-category'
                  }
                )
              ),
              e(
                'div',
                null,
                e('label', { className: 'block text-sm font-semibold mb-2' }, 'Start Date'),
                e('input', {
                  type: 'date',
                  defaultValue: editingTransaction.startDate || new Date().toISOString().split('T')[0],
                  className: `w-full px-4 py-2 rounded-lg border ${borderClass} ${darkMode ? 'bg-gray-700' : 'bg-white'}`,
                  id: 'transaction-start'
                })
              )
            ),
            e(
              'div',
              { className: `p-4 border-t ${borderClass} flex justify-end gap-2` },
              editingTransaction.id
                ? e(
                    'button',
                    {
                      onClick: function() {
                        if (window.confirm('Delete this transaction?')) {
                          setTransactions(function(prev) {
                            return prev.filter(function(item) {
                              return item.id !== editingTransaction.id;
                            });
                          });
                          setEditingTransaction(null);
                        }
                      },
                      className: 'px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors'
                    },
                    'Delete'
                  )
                : null,
              e(
                'button',
                {
                  onClick: function() {
                    setEditingTransaction(null);
                  },
                  className: `px-4 py-2 rounded-lg transition-colors ${darkMode ? 'bg-gray-700 hover:bg-gray-600' : 'bg-gray-200 hover:bg-gray-300'}`
                },
                'Cancel'
              ),
              e(
                'button',
                {
                  onClick: function() {
                    const name = document.getElementById('transaction-name').value;
                    const amount = parseFloat(document.getElementById('transaction-amount').value);
                    const type = document.getElementById('transaction-type').value;
                    const frequency = document.getElementById('transaction-frequency').value;
                    const category = document.getElementById('transaction-category').value || 'general';
                    const startDate = document.getElementById('transaction-start').value;

                    if (!name || !amount || !startDate) {
                      window.alert('Please fill in all required fields');
                      return;
                    }

                    const payload = {
                      id: editingTransaction.id || Date.now(),
                      name,
                      amount,
                      type,
                      frequency,
                      category,
                      startDate
                    };

                    setTransactions(function(prev) {
                      if (editingTransaction.id) {
                        return prev.map(function(item) {
                          return item.id === editingTransaction.id ? payload : item;
                        });
                      }
                      return prev.concat([payload]);
                    });

                    setEditingTransaction(null);
                  },
                  className: 'px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors'
                },
                editingTransaction.id ? 'Save Changes' : 'Add Transaction'
              )
            )
          )
        );
      }

      function renderDayModal() {
        if (!showDayModal || selectedDate === null) return null;
        return e(
          'div',
          {
            className: 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4',
            onClick: function() {
              setShowDayModal(false);
            }
          },
          e(
            'div',
            {
              className: `${cardBg} rounded-lg shadow-xl max-w-2xl w-full max-h-[80vh] overflow-hidden`,
              onClick: function(event) {
                event.stopPropagation();
              }
            },
            e(
              'div',
              { className: `p-6 border-b ${borderClass} flex items-center justify-between` },
              e(
                'div',
                null,
                e(
                  'h3',
                  { className: 'text-2xl font-bold' },
                  new Date(year, month, selectedDate).toLocaleDateString('default', {
                    weekday: 'long',
                    month: 'long',
                    day: 'numeric',
                    year: 'numeric'
                  })
                ),
                e(
                  'p',
                  { className: `text-sm ${textMuted} mt-1` },
                  'Daily Total: ',
                  e(
                    'span',
                    {
                      className: `font-semibold ${getDailyTotal(selectedDate) >= 0 ? 'text-green-500' : 'text-red-500'}`
                    },
                    `$${getDailyTotal(selectedDate) >= 0 ? '+' : ''}${getDailyTotal(selectedDate).toLocaleString()}`
                  )
                )
              ),
              e(
                'button',
                {
                  onClick: function() {
                    setShowDayModal(false);
                  },
                  className: `p-2 rounded-lg hover:bg-opacity-80 transition-colors ${darkMode ? 'hover:bg-gray-700' : 'hover:bg-gray-100'}`
                },
                e(
                  'svg',
                  { className: 'w-6 h-6', fill: 'none', stroke: 'currentColor', viewBox: '0 0 24 24' },
                  e('path', {
                    strokeLinecap: 'round',
                    strokeLinejoin: 'round',
                    strokeWidth: '2',
                    d: 'M6 18L18 6M6 6l12 12'
                  })
                )
              )
            ),
            e(
              'div',
              { className: 'p-6 overflow-y-auto max-h-[calc(80vh-140px)]' },
              getTransactionsForDate(selectedDate).length
                ? e(
                    'div',
                    { className: 'space-y-3' },
                    getTransactionsForDate(selectedDate).map(function(t) {
                      return e(
                        'div',
                        {
                          key: t.id,
                          className: `p-4 rounded-lg ${darkMode ? 'bg-gray-700' : 'bg-gray-100'} hover:bg-opacity-80 transition-colors`
                        },
                        e(
                          'div',
                          { className: 'flex justify-between items-start' },
                          e(
                            'div',
                            { className: 'flex-1' },
                            e('p', { className: 'font-semibold text-lg' }, t.name),
                            e(
                              'div',
                              { className: 'flex gap-4 mt-2' },
                              e('span', { className: `text-sm ${textMuted}` }, t.frequency),
                              e('span', { className: `text-sm ${textMuted}` }, t.category)
                            )
                          ),
                          e(
                            'div',
                            { className: 'flex flex-col gap-2 items-end' },
                            e(
                              'p',
                              { className: `text-2xl font-bold ${t.type === 'income' ? 'text-green-500' : 'text-red-500'}` },
                              `${t.type === 'income' ? '+' : '-'}$${t.amount}`
                            ),
                            e(
                              'button',
                              {
                                onClick: function() {
                                  setShowDayModal(false);
                                  setEditingTransaction(t);
                                },
                                className: 'text-xs px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors'
                              },
                              'Edit'
                            )
                          )
                        )
                      );
                    })
                  )
                : e(
                    'div',
                    { className: 'text-center py-12' },
                    e(CalendarIcon, { className: `w-16 h-16 mx-auto mb-4 ${textMuted}` }),
                    e('p', { className: `text-lg ${textMuted}` }, 'No transactions scheduled for this day'),
                    e(
                      'button',
                      {
                        onClick: function() {
                          setShowDayModal(false);
                          setEditingTransaction({
                            startDate: new Date(year, month, selectedDate).toISOString().split('T')[0],
                            frequency: 'one-time'
                          });
                        },
                        className: 'mt-4 px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors'
                      },
                      'Add Transaction'
                    )
                  )
            ),
            e(
              'div',
              { className: `p-4 border-t ${borderClass} flex justify-end gap-2` },
              e(
                'button',
                {
                  onClick: function() {
                    setShowDayModal(false);
                    setEditingTransaction({
                      startDate: new Date(year, month, selectedDate).toISOString().split('T')[0],
                      frequency: 'one-time'
                    });
                  },
                  className: 'px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors'
                },
                'Add Transaction for This Day'
              ),
              e(
                'button',
                {
                  onClick: function() {
                    setShowDayModal(false);
                  },
                  className: `px-4 py-2 rounded-lg transition-colors ${darkMode ? 'bg-gray-700 hover:bg-gray-600' : 'bg-gray-200 hover:bg-gray-300'}`
                },
                'Close'
              )
            )
          )
        );
      }

      return e(
        'div',
        {
          className: `min-h-screen ${bgClass} ${textClass} transition-colors duration-200`,
          onClick: handleBackgroundClick
        },
        renderHeader(),
        e(
          'div',
          { className: 'max-w-7xl mx-auto px-4 py-6 pt-24' },
          renderSummary(),
          renderMainContent(),
          renderCryptoSection()
        ),
        renderContextMenu(),
        renderSidebarBackdrop(),
        renderSidebar(),
        renderCryptoManagerModal(),
        renderTransactionManagerModal(),
        renderTransactionEditorModal(),
        renderDayModal()
      );
    }

    function AppRoot() {
      return e(BudgieApp);
    }

    try {
      const container = document.getElementById('root');
      if (!container) {
        throw new Error('Root container not found');
      }
      ReactDOM.createRoot(container).render(e(AppRoot));
    } catch (error) {
      console.error(error);
      showRuntimeError(error);
    }
  }
})();


  </script>
  <!-- Manual Test Steps: (1) Open this file directly in a browser. (2) Confirm the dashboard and sanity-check chart render without a white screen. (3) Verify the console shows no uncaught errors. (4) Block the CDN to see the full-screen overlay indicating which source failed. -->
</body>
</html>
